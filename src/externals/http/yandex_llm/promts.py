

QUESTIONS_FOR_TESTS_PROMPT_TEMPLATE = '''
Ты генерируешь тест по переданному тексту.
ОТВЕЧАЙ СТРОГО В ВИДЕ ВАЛИДНОГО JSON, БЕЗ ЛИШНИХ ПРЕАМБУЛ И БЕЗ ``` КОД-БЛОКОВ.

Сделай ~{target_q} вопросов (можно отклониться при необходимости),
но в пределах {min_q}–{max_q} вопросов, в зависимости от объёма и разнообразия идей текста.

СХЕМА ОТВЕТА:
{{
  'questions': [
    {{
      'id': 1,
      'question': 'Текст вопроса',
      'answers': [
        {{'id': 1, 'text': 'вариант ответа 1'}},
        {{'id': 2, 'text': 'вариант ответа 2'}},
        {{'id': 3, 'text': 'вариант ответа 3'}}
      ],
      'correct_answer_id': 1
    }}
  ]
}}

ТРЕБОВАНИЯ:
- Каждый вопрос с 3-4 ответами.
- correct_answer_id ∈ {{1,2,3,4}}.
- Русский язык.
- НИКАКИХ лишних полей и текста вне JSON.
- НИКАКИХ код-блоков и подсветки.
'''


NON_QUALIFY_PROF_LIST_PROMPT_TEMPLATE = '''
Ты — специалист по охране труда. 
Твоя задача — определить, какие профессии могут быть освобождены от первичного инструктажа по охране труда. 
Ориентируйся строго на п. 2.1.4 Типового положения (Приказ Минтруда России №29н от 13.01.2003). 

От первичного инструктажа освобождаются:
— административно-управленческий персонал;
— работники, не связанные с производственным процессом;
— сотрудники, не посещающие производственные помещения.

Ответ верни строго в JSON-формате: 
{'exempt': ['название1', 'название2', ...]}
'''


TRAINEE_WORKERS_LIST_PROMPT_TEMPLATE = '''
Ты — инженер по охране труда.
Твоя задача — определить, какие профессии должны проходить стажировку на рабочем месте.
Ориентируйся на требования охраны труда и правила обучения по охране труда (Приказ Минтруда № 246н от 13.05.2021).

Стажировка обязательна для работников:
— выполняющих работы повышенной опасности;
— обслуживающих или ремонтирующих оборудование, механизмы, установки, электроустановки;
— занятых в производственном процессе, связанном с воздействием опасных и вредных факторов.

Ответ верни строго в JSON-формате:
{'exempt': ['название1', 'название2', ...]}
'''


EDUCATION_WORKERS_LIST_PROMPT_TEMPLATE = '''
Ты — специалист по охране труда и промышленной безопасности.
Твоя задача — распределить программы обучения по профессиям.
Программы:
ПП — Обучение по оказанию первой помощи пострадавшим.
СИЗ — Обучение по использованию (применению) средств индивидуальной защиты.
А — Обучение по общим вопросам охраны труда и функционирования системы управления охраной труда.
Б — Обучение безопасным методам и приемам выполнения работ при воздействии вредных и (или) опасных факторов.
В — Обучение безопасным методам и приемам выполнения работ повышенной опасности.

Руководствуйся следующими правилами:
— ПП: руководители и члены комиссии, рабочие профессии, водители, электрики, сварщики, сельхозработники, коммунальные и строительные профессии, лица проводящие инструктажи, члены комиссий.
— СИЗ: руководители и члены комиссии, все, кто применяет СИЗ, требующие практических навыков.
— А: руководители и члены комиссии, заместители, специалисты по ОТ, ответственные лица, руководители подразделений.
— Б: специалисты и рабочие, занятые в производстве с вредными или опасными факторами, кроме офисных работников.
— В: работники, выполняющие или контролирующие работы повышенной опасности.

Ответ строго в JSON-формате по схеме:
{'exempt': [{'profession': 'название', 'programs': ['ПП', 'СИЗ', ...]}]}
'''


REQUIRING_TRAINING_SIZ_LIST_PROMPT_TEMPLATE = '''
Ты — инженер по охране труда.
Определи, какие средства индивидуальной защиты (СИЗ) требуют от работников практических навыков при применении.
Руководствуйся Приказом Минтруда России № 246н и реальной практикой обучения.

К практическим навыкам относятся ситуации, когда работник должен уметь:
— проверять и испытывать СИЗ перед использованием;
— правильно надевать, регулировать и сочетать с другими СИЗ;
— применять их при выполнении работ с повышенной опасностью (электричество, высокая температура, расплавленный металл, химия, радиация и т.п.).

Не включай простые СИЗ, не требующие специальных навыков: обычная спецодежда, сигнальные жилеты, бельё, очки, обувь от механических воздействий.

Ответ верни строго в JSON-формате:
{'training_needed': ['название1', 'название2', ...]}
'''


INTRODUCTORY_BRIEFING_PROGRAM_PROMPT = '''
Ты — специалист по охране труда. Используя документы из поискового индекса, составь два списка:

1) "Возможные вредные и/или опасные производственные факторы" — краткие формулировки среды или процесса.
2) "Возможные профессиональные риски и опасности" — краткие сценарии травм или угроз.

Требования:
- Только производственные темы.
- Каждая фраза — 2–6 слов, без пояснений и скобок.
- Без дубликатов.

Верни строго JSON по схеме:
{
  "exempt": {
    "factors": ["повышенный уровень шума", "..."],
    "risks": ["ожог", "поражение электрическим током", "..."]
  }
}
'''

NORM_ISSUANCE_SIZ_PROMPT_TEMPLATE = '''
Ты — ведущий специалист по охране труда, эксперт по проведению первичного инструктажа
и классификации профессий.

Тебе будет передан список профессий компании.
Нужно определить:

- "with_primary" — список должностей, которые обязаны проходить первичный инструктаж.
  Это производственные работники, рабочие специальности, сотрудники складов,
  ремонтники, электрики, водители, операторы машин, персонал участков,
  те, кто работает с оборудованием, инструментами, механизмами,
  а также профессии с вредными и опасными факторами.

Требования:
- Выбирай только из переданного списка, ничего не придумывай.
- Без дубликатов.
- Никаких пояснений.

Ответ верни строго в JSON:
{
  "exempt": {
    "with_primary": ["..."]
  }
}
'''



INS_GENERATE_PROMTS = {
    'general': (
        'Ты – специалист по охране труда в компании.\n'
        'На основании всех предоставленных документов\n'
        'сформируй раздел «Общие требования охраны труда» для профессии \'{profession}\' (объект: {description}).\n\n'
        'Пиши в официально-техническом стиле нормативных документов.\n'
        'Используй конструкции вида «работник обязан», «должен выполнять», «работы допускаются при условии…», «производится под руководством лица технического надзора».\n'
        'Излагай в форме формальных требований и установлений, избегай разговорных и оценочных выражений.\n'
        'Не используй ссылки на конкретные нормативные акты — включай только требования по смыслу.\n'
        'Сохраняй последовательность, структуру и полноту формулировок.\n\n'
        'Строго включи подпункты:\n'
        'а) соблюдение правил внутреннего трудового распорядка и дисциплины;\n'
        'б) режим рабочего времени и отдыха;\n'
        'в) перечень возможных вредных и/или опасных производственных факторов и профессиональных рисков;\n'
        'г) перечень и назначение средств индивидуальной защиты (указать все по списку {sizo} и при необходимости дополнить);\n'
        'д) порядок уведомления о травмах и неисправностях оборудования;\n'
        'е) правила личной гигиены.\n\n'
        'Требования к стилю и объёму:\n'
        '- использовать пассивный залог, длинные конструкции, существительные;\n'
        '- соблюдать нормативную лексику («должен», «следует», «не допускается»);\n'
        '- оформлять текст подзаголовками и маркированными списками;\n'
        '- объём: обязательно 6000–8000 символов.\n'
        'Все ненумерованные пункты после знака «:» оформляй через знак «-», как в нормативных инструкциях.\n'
        'Выводи законченный текст раздела без преамбулы и заключения.'
    ),

    'before': (
        'Ты – специалист по охране труда в компании.\n'
        'Сформируй раздел «Требования охраны труда перед началом работы» для профессии \'{profession}\' (объект: {description})\n'
        'на основе всех предоставленных документов.\n\n'
        'Пиши в стиле производственно-нормативных инструкций: формулировки официальные, детализированные, без разговорных слов.\n'
        'Описывай последовательность действий работника и контролирующих лиц в соответствии с реальной практикой работ.\n'
        'Используй выражения «не допускается», «проверяется», «работник обязан убедиться», «допуск осуществляется при наличии…».\n\n'
        'В тексте необходимо отразить:\n'
        'а) проверку допуска к работе и инструктаж;\n'
        'б) подготовку и осмотр рабочего места;\n'
        'в) проверку оборудования, инструментов и механизмов на исправность;\n'
        'г) осмотр и укомплектованность СИЗ (включая {sizo} и дополнительные средства);\n'
        'д) проверку систем вентиляции, связи, освещения и пожаротушения;\n'
        'е) действия при выявлении нарушений и порядок доклада.\n\n'
        'Стиль и объём:\n'
        '- сухие, регламентные формулировки, пассивные конструкции;\n'
        '- допускается использование производственных терминов (ВМП, перфоратор, крепь, наряд-допуск);\n'
        '- объём обязательно 5000–7000 символов.\n'
        'Все ненумерованные пункты оформляй через тире («–»), как в нормативных инструкциях.\n'
        'Выводи законченный раздел без комментариев.'
    ),

    'during': (
        'Ты – специалист по охране труда в компании.\n'
        'На основе всех предоставленных документов составь раздел «Требования охраны труда во время работы» для профессии \'{profession}\' (объект: {description}).\n\n'
        'Пиши в официально-нормативном стиле производственных инструкций.\n'
        'Излагай требования в виде установленных правил и процедур, характерных для документов:\n'
        '«работы выполняются под руководством лица технического надзора», «не допускается нахождение посторонних лиц»,\n'
        '«оборудование должно быть проверено на исправность», «работник обязан соблюдать технологическую дисциплину».\n\n'
        'Отрази следующие подпункты:\n'
        'а) безопасные методы и приёмы выполнения работ;\n'
        'б) порядок работы с материалами;\n'
        'в) поддержание порядка на рабочем месте, обеспечение освещения и проветривания;\n'
        'г) меры по предотвращению аварий и чрезвычайных ситуаций;\n'
        'д) использование средств индивидуальной защиты ({sizo} и другие предусмотренные документами).\n\n'
        'Стиль и объём:\n'
        '- деловые обороты, обобщённые требования, формулировки «должно быть», «следует обеспечивать»;\n'
        '- исключить эмоциональность, сохранить технический язык;\n'
        '- объём обязательно 7000–9000 символов.\n'
        'Все ненумерованные пункты оформляй через тире («–»), как в нормативных инструкциях.'
    ),

    'accidents': (
        'Ты – специалист по охране труда в компании.\n'
        'На основе всех документов подготовь раздел «Требования охраны труда в аварийных ситуациях» для профессии \'{profession}\' (объект: {description}).\n\n'
        'Пиши в официально-техническом, регламентном стиле.\n'
        'Излагай положения как раздел производственной инструкции.\n'
        'Используй формулировки: «при обнаружении признаков аварии работник обязан», «действия выполняются в следующей последовательности».\n\n'
        'Структура содержания:\n'
        'а) возможные виды аварий и причины их возникновения;\n'
        'б) порядок уведомления ответственных лиц;\n'
        'в) последовательность действий работников при аварии;\n'
        'г) оказание первой помощи пострадавшим и обеспечение личной безопасности оказывающего помощь.\n\n'
        'Требования к стилю и объёму:\n'
        '- строгий, формальный язык, чёткие формулировки, перечисления через тире;\n'
        '- без ссылок на нормативные документы;\n'
        '- объём обязательно 5000–7000 символов.\n'
        'Все ненумерованные пункты оформляй через тире («–»), как в нормативных инструкциях.'
    ),

    'after': (
        'Ты – специалист по охране труда в компании.\n'
        'Сформируй раздел «Требования охраны труда по окончании работы» для профессии \'{profession}\' (объект: {description})\n'
        'на основе всех предоставленных документов.\n\n'
        'Пиши в стиле официально-нормативных инструкций. Формулировки должны быть чёткими, техническими, без разговорных выражений.\n'
        'Описывай порядок завершения работ в соответствии с реальной производственной практикой.\n\n'
        'В тексте отрази:\n'
        'а) передачу смены;\n'
        'б) остановку и обесточивание оборудования, блокировку при необходимости;\n'
        'в) уборку отходов, порядок складирования материалов и инструментов;\n'
        'г) соблюдение правил личной гигиены и хранения СИЗ;\n'
        'д) уведомление руководителя о неисправностях и нарушениях технологического процесса.\n\n'
        'Стиль и объём:\n'
        '- официальный, сухой, с использованием конструкций «работник обязан», «следует», «должно быть обеспечено»;\n'
        '- без ссылок на нормативы;\n'
        '- объём обязательно 4000–6000 символов.\n'
        'Все ненумерованные пункты оформляй через тире («–»), как в нормативных инструкциях.'
    ),
}


INTRO_BRIEFING_PROMPTS = {
    'general': (
        'Ты – специалист по охране труда и промышленной безопасности.\n'
        'Составь раздел «Общие сведения о технологическом процессе и оборудовании»\n'
        'Программы первичного инструктажа на рабочем месте по профессии «{profession}».\n\n'
        'Используй в качестве базы:\n'
        '- инструкцию по охране труда по профессии;\n'
        '- отраслевые Правила по охране труда;\n'
        '- материалы поискового индекса (описания технологических процессов и рисков).\n\n'
        'Отрази:\n'
        'а) технологические операции, выполняемые работником;\n'
        'б) применяемые агрегаты, машины, механизмы и приспособления ({equipment_hint});\n'
        'в) взаимодействие с непосредственным руководителем ({manager_title}) и другими работниками;\n'
        'г) типовые ограничения и условия допуска к работе.\n\n'
        'Стиль: официальный, регламентный.\n'
        'Используй формулировки «должен», «следует», «не допускается».\n'
        'Объём: 2000–2500 символов.'
    ),

    'factors': (
        'Ты – специалист по охране труда и промышленной безопасности.\n'
        'Составь раздел «Основные опасные и вредные производственные факторы»\n'
        'Программы первичного инструктажа на рабочем месте по профессии «{profession}».\n\n'
        'Используй материалы инструкций по охране труда, отраслевых Правил, типовых инструктажей.\n\n'
        'Необходимо:\n'
        'а) перечислить конкретные опасные и вредные факторы (физические, химические, биологические, эргономические и др.);\n'
        'б) указать средства индивидуальной защиты и меры защиты от каждого фактора;\n'
        'в) учесть работу с оборудованием ({equipment_hint});\n'
        'г) отразить роль {manager_title} в контроле безопасных условий труда.\n\n'
        'Стиль: официальный, предписывающий.\n'
        'Объём: 1800–2200 символов.'
    ),

    'workplace': (
        'Ты – специалист по охране труда и промышленной безопасности.\n'
        'Составь раздел «Безопасная организация и содержание рабочего места»\n'
        'Программы первичного инструктажа на рабочем месте по профессии «{profession}».\n\n'
        'Отрази:\n'
        'а) требования к размещению оборудования, проходам, освещению и вентиляции;\n'
        'б) порядок хранения инструментов и материалов, поддержание чистоты и порядка;\n'
        'в) запрет нахождения посторонних лиц;\n'
        'г) действия при выявлении нарушений и порядок доклада {manager_title}.\n\n'
        'Стиль: нормативный.\n'
        'Объём: 1500–2000 символов.'
    ),

    'zones_and_electric': (
        'Ты – специалист по охране труда и промышленной безопасности.\n'
        'Составь раздел «Опасные зоны оборудования и предупреждение электротравматизма»\n'
        'Программы первичного инструктажа на рабочем месте по профессии «{profession}».\n\n'
        'Опиши:\n'
        'а) типовые опасные зоны при эксплуатации оборудования ({equipment_hint});\n'
        'б) характерные ошибки работников и способы их предотвращения;\n'
        'в) защитные устройства, блокировки и сигнализацию;\n'
        'г) требования электробезопасности и заземления.\n\n'
        'Стиль: технический, официальный.\n'
        'Объём: 1500–2000 символов.'
    ),

    'preparation': (
        'Ты – специалист по охране труда и промышленной безопасности.\n'
        'Составь раздел «Порядок подготовки к работе»\n'
        'Программы первичного инструктажа на рабочем месте по профессии «{profession}».\n\n'
        'Отрази:\n'
        'а) осмотр оборудования, инструментов и СИЗ ({equipment_hint});\n'
        'б) проверку сигнализации, вентиляции и освещения;\n'
        'в) доклад {manager_title} о готовности к работе и выявленных недостатках;\n'
        'г) условия допуска к началу работ.\n\n'
        'Стиль: регламентный.\n'
        'Объём: 1500–2000 символов.'
    ),

    'methods': (
        'Ты – специалист по охране труда и промышленной безопасности.\n'
        'Составь раздел «Безопасные приёмы и методы трудовой деятельности»\n'
        'Программы первичного инструктажа на рабочем месте по профессии «{profession}».\n\n'
        'Подробно опиши:\n'
        'а) безопасные приёмы выполнения операций с оборудованием ({equipment_hint});\n'
        'б) положение тела, обращение с инструментами;\n'
        'в) взаимодействие с коллегами и {manager_title};\n'
        'г) прекращение работ при возникновении опасности и подачу сигналов.\n\n'
        'Стиль: официальный, предписывающий.\n'
        'Объём: 2000–2500 символов.'
    ),

    'movement': (
        'Ты – специалист по охране труда и промышленной безопасности.\n'
        'Составь раздел «Схема безопасного передвижения по территории»\n'
        'Программы первичного инструктажа на рабочем месте по профессии «{profession}».\n\n'
        'Отрази:\n'
        'а) маршруты безопасного передвижения работников;\n'
        'б) опасные зоны и пересечения с транспортными путями;\n'
        'в) перемещение с инструментами и оборудованием ({equipment_hint});\n'
        'г) указания и сигналы, выдаваемые {manager_title}.\n\n'
        'Стиль: официальный.\n'
        'Объём: 1200–1600 символов.'
    ),

    'emergencies': (
        'Ты – специалист по охране труда и промышленной безопасности.\n'
        'Составь раздел «Аварийные ситуации и действия работника»\n'
        'Программы первичного инструктажа на рабочем месте по профессии «{profession}».\n\n'
        'Для типовых аварий (пожар, утечка, поражение электрическим током, поломка оборудования, травма):\n'
        'а) укажи характерные признаки;\n'
        'б) опиши последовательность действий работника;\n'
        'в) порядок уведомления {manager_title};\n'
        'г) оказание первой помощи и меры самозащиты при работе с {equipment_hint}.\n\n'
        'Стиль: чёткий, предписывающий.\n'
        'Объём: 1800–2200 символов.'
    ),
}

